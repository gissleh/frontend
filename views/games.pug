extends layout.pug

block append head
    script(src='/javascripts/moment-2.20.1.min.js')
    script(src='/javascripts/jquery.twbsPagination-1.4.1.min.js')

block scripts
    script.
        var total = !{JSON.stringify(total_pages)}
        var page = parseInt(!{JSON.stringify(page_num)})
        $(function() {
            $('.sync-pagination').twbsPagination({
                totalPages: total,
                visiblePages: 7,
                initiateStartPageClick: false,
                startPage: page,
                cssStyle: '',
                prevText: '<span aria-hidden="true">&laquo;</span>',
                nextText: '<span aria-hidden="true">&raquo;</span>',
                onPageClick: function (event, page) {
                    location.href = '/games/page/' + page;
                }
            });
        });
    script.
        $(function() {
            $('#table-games-list').on('mouseup', '#continue-game-button', function (e) {
                openLink('/games/' + $(this).data('game'), e);
            });
            $('#table-games-list').on('mouseup', '#spectate-game-button', function(e) {
                openLink('/games/' + $(this).data('game') + '/spectate', e);
            });
            $('#table-games-list').on('mouseup', '#view-game-button', function (e) {
                openLink('/games/' + $(this).data('game') + '/results', e);
            });
        });

        function openLink(url, mouseEvent) {
            if (mouseEvent.which == 1) {
                location.href = url;
            }
            else if (mouseEvent.which == 2) {
                window.open(url);
                mouseEvent.preventDefault()
            }
        }

block content
    div
        h2 Games
        p.
            Overview over all played games

    div(class='col-md-14 text-right')
        ul(class="sync-pagination")

    table(class='table' id='table-games-list')
            thead
                tr
                    th(hidden=true)
                    th Start Time
                    th Venue
                    th Mode
                    th type
                    th Players
                    th Winner
                    th Results
            tbody
                each game in games
                    - var isLive = moment.duration(moment().diff(game.last_throw_time)).asMinutes().toFixed() < 2
                    tr
                        th(hidden='true' scope='row')= game.id
                        td(class='col-sm-2')
                            div(style='display: inline-block; padding-right: 6px')= moment(game.created_at).format('YYYY-MM-DD HH:mm:ss')
                            if isLive
                                label(class='label label-info' style='line-height: inherit;') Live
                        td(class='col-sm-1')
                            if game.venue
                                div= game.venue.name
                        td(class='col-sm-1')= game.game_type.name
                        td(class='col-sm-1')= game.game_mode.name
                        td(class='col-sm-1')
                            each id in game.players
                                div(style='margin-bottom: 5px;')
                                    span(class='label label-primary' style='line-height: inherit;')= players[id].name
                        if game.is_finished
                            td(class='col-sm-1')
                                if game.winner_id === null
                                    div: span(class='label label-default' style='line-height: inherit;') Draw
                                else
                                    div: span(class='label label-success' style='line-height: inherit;')= players[game.winner_id].name
                        else
                            td(class='col-sm-2')
                        td(class='col-sm-2')
                            if !game.is_finished
                                button(type='button' id='continue-game-button' data-game=game.id class='btn btn-primary btn-block') Continue
                                button(type='button' id='spectate-game-button' data-game=game.id class='btn btn-primary btn-block') Spectate
                            else
                                button(type='button' id='view-game-button' data-game=game.id class='btn btn-primary btn-block') View

    div(class='col-md-14 text-right')
        ul(id='pagination-games' class="sync-pagination pagination-md")