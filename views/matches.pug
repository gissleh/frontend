extends layout.pug

block append head
    script(src='/javascripts/moment-2.20.1.min.js')
    script(src='/javascripts/jquery.twbsPagination-1.4.1.min.js')

block scripts
    script.
        var total = !{JSON.stringify(total_pages)}
        var page = parseInt(!{JSON.stringify(page_num)})
        $(function() {
            $('.sync-pagination').twbsPagination({
                totalPages: total,
                visiblePages: 7,
                initiateStartPageClick: false,
                startPage: page,
                cssStyle: '',
                prevText: '<span aria-hidden="true">&laquo;</span>',
                nextText: '<span aria-hidden="true">&raquo;</span>',
                onPageClick: function (event, page) {
                    location.href = '/matches/page/' + page;
                }
            });
        });
    script.
        $(function() {
            $('#table-matches-list').on('mouseup', '#continue-match-button', function (e) {
                openLink('/matches/' + $(this).data('match'), e);
            });
            $('#table-matches-list').on('mouseup', '#spectate-match-button', function(e) {
                openLink('/matches/' + $(this).data('match') + '/spectate', e);
            });
            $('#table-matches-list').on('mouseup', '#view-match-button', function (e) {
                openLink('/matches/' + $(this).data('match') + '/result', e);
            });
        });

        function openLink(url, mouseEvent) {
            if (mouseEvent.which == 1) {
                location.href = url;
            }
            else if (mouseEvent.which == 2) {
                window.open(url);
                mouseEvent.preventDefault()
            }
        }

block content
    div
        h2 Matches
        p.
            Overview over all played matches

    div(class='col-md-14 text-right')
        ul(class="sync-pagination")

    table(class='table' id='table-matches-list')
            thead
                tr
                    th(hidden=true)
                    th Start Time
                    th Venue
                    th Type
                    th Mode
                    th Players
                    th Winner
                    th Results
            tbody
                each match in matches
                    - var isLive = !match.is_finished && moment.duration(moment().diff(match.last_throw_time)).asMinutes().toFixed() < 2
                    tr
                        th(hidden='true' scope='row')= match.id
                        td(style='width: 22%;')
                            div(style='display: inline-block; padding-right: 6px')= moment(match.created_at).format('YYYY-MM-DD HH:mm:ss')
                            if match.tournament_id
                                label(class='label label-warning' style='line-height: inherit;') Official
                            if isLive
                                label(class='label label-info' style='line-height: inherit;') Live
                        td(style='width: 10%;')
                            if match.venue
                                div= match.venue.name
                        td(style='width: 8%')= match.match_type.name
                        td(style='width: 10%')= match.match_mode.name
                        td(style='width: 15%')
                            each id in match.players
                                div(style='margin-bottom: 5px;')
                                    span(class='label label-primary' style='line-height: inherit;')= players[id].name
                        if match.is_finished
                            td(style='width: 15%;')
                                if match.winner_id === null
                                    div: span(class='label label-default' style='line-height: inherit;') Draw
                                else
                                    div: span(class='label label-success' style='line-height: inherit;')= players[match.winner_id].name
                        else
                            td(style='width: 15%;')
                        td(style='width: 20%;')
                            if !match.is_finished
                                button(type='button' id='continue-match-button' data-match=match.id class='btn btn-primary btn-block') Continue
                                button(type='button' id='spectate-match-button' data-match=match.id class='btn btn-primary btn-block') Spectate
                            else
                                button(type='button' id='view-match-button' data-match=match.id class='btn btn-primary btn-block') View

    div(class='col-md-14 text-right')
        ul(id='pagination-matches' class="sync-pagination pagination-md")