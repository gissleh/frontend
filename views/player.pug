extends layout.pug

include mixins/dart.pug

block append head
    script(src='/javascripts/webgl-heatmap.js')

block scripts
    script.
        $(function () {
            $('#player-hits-table').DataTable({
                searching: false,
                bInfo : false,
                order: [[ 1,  'desc' ]]
            });

            $('#player-visits-table').DataTable({
                searching: false,
                bInfo : false,
                order: [[ 3,  'desc' ]],
                columnDefs: [ { targets: [ 1, 2 ], orderable: false, searchable: false } ]
            });

            $('#btn-view-progression').click(function() {
                location.href = '/players/' + $(this).data('player') + '/progression'
            });
        });
    script.
        var scoresMap = !{JSON.stringify(statistics.hits)};
        $(function () {
            var canvas = $('#dartboard-heatmap')[0];
            drawHeatmap(canvas, scoresMap, 0, 5, 20, 30);
            $("#heatmap-value-selector").change(function () {
                var size = 5;
                var spread = 20;
                var intensity = 30;
                var display = this.value;
                if (display == 2) {
                    size = 10;
                } else if (display == 3) {
                    size = 3
                    spread = 10
                }
                drawHeatmap(canvas, scoresMap, display, size, spread, intensity);
            });
        });

block content
    h2 Statistics for #{player.name}

    div(class='table-responsive')
        h3 Overview
        table(id='player-statistics-table' class='table table-striped table-bordered')
            thead
                tr
                    th Played
                    th Won
                    th Win %
                    th First 9 PPD
                    th Overall PPD
                    th Checkout%
                    th Progression
            tbody
                    tr
                        td= player.games_played
                        td= player.games_won
                        td= player.games_played == 0 ? 0 : (player.games_won * 100 / player.games_played).toFixed(2)
                        td= statistics.first_nine_ppd.toFixed(2)
                        td= statistics.ppd.toFixed(2)
                        td= player.games_won === 0 ? '-' : statistics.checkout_percentage.toFixed(2) + '%'
                        td: button(type='button' class='btn btn-primary btn-block' id='btn-view-progression' data-player=player.id) View

        h3 High Scores
        table(id='player-scores-table' class='table table-striped table-bordered')
            thead
                tr
                    th 60+
                    th 100+
                    th 140+
                    th 180s
            tbody
                    tr
                        td= statistics.scores_60s_plus
                        td= statistics.scores_100s_plus
                        td= statistics.scores_140s_plus
                        td= statistics.scores_180s
                    tr
                        th Best PPD / First 9
                        th Best 301
                        th Best 501
                        th Highest Checkout
                    tr
                        td= statistics.best_ppd.toFixed(2) + ' / ' + statistics.best_first_nine_ppd.toFixed(2)
                        td= statistics.best_301
                        td= statistics.best_501
                        td= statistics.highest_checkout

        h3 Accuracy
        table(id='player-accuracy-table' class='table table-striped table-bordered')
            thead
                tr
                    th Overall Accuracy
                    th Accuracy 20s
                    th Accuracy 19s
            tbody
                    tr
                        td= statistics.accuracy_overall === null ? 'Not Available' : statistics.accuracy_overall.toFixed(2)
                        td= statistics.accuracy_20 === null ? 'Not Available' : statistics.accuracy_20.toFixed(2)
                        td= statistics.accuracy_19 === null ? 'Not Available' : statistics.accuracy_19.toFixed(2)

        h3 Hits
        table(id='player-hits-table' class='table table-striped table-bordered')
            thead
                tr
                    th Dart
                    th Count
                    th Hit %
            tbody
                each score, key in statistics.hits
                    each value, multiplier in statistics.hits[key]
                        tr
                            +dart_container(key, multiplier)
                            td= value
                            td= (value * 100 / statistics.darts_thrown).toFixed(2) + '%'

    h3 Heatmap
    select(id='heatmap-value-selector' name='dart-values')
        option(value=0 default=true) All
        option(value=1) Singles
        option(value=2) Doubles
        option(value=3) Trebles
    div(style='text-align: center;')
        canvas(id='dartboard-heatmap')

    h3 Visits
    table(id='player-visits-table' class='table table-striped table-bordered')
        thead
            tr
                th Vist
                th
                th
                th Count
        tbody
            each visit in statistics.visits
                tr
                    +dart_container(visit.first_dart.value, visit.first_dart.multiplier)
                    +dart_container(visit.second_dart.value, visit.second_dart.multiplier)
                    +dart_container(visit.third_dart.value, visit.third_dart.multiplier)
                    td= visit.count