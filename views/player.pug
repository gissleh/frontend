extends layout.pug

block append head
    script(src='/javascripts/webgl-heatmap.js')

block scripts
    script.
        $(function () {
            $('#player-hits-table').DataTable({
                searching: false,
                bInfo : false,
                order: [[ 1,  'desc' ]],
                columnDefs: [ { targets: [ 1 ], visible: true } ]
            });
        });
    script.
        var scoresMap = !{JSON.stringify(statistics.hits)};
        $(function () {
            var canvas = $('#dartboard-heatmap')[0];
            drawHeatmap(canvas, scoresMap, 0, 5, 20, 30);
            $("#heatmap-value-selector").change(function () {
                var size = 5;
                var spread = 20;
                var intensity = 30;
                var display = this.value;
                if (display == 2) {
                    size = 10;
                } else if (display == 3) {
                    size = 3
                    spread = 10
                }
                drawHeatmap(canvas, scoresMap, display, size, spread, intensity);
            });
        });

block content
    h2 Statistics for #{player.name}

    div(class='table-responsive')
        table(id='player-statistics-table' class='table table-striped table-bordered')
            thead
                tr
                    th Played
                    th Won
                    th Win %
                    th First 9 PPD
                    th Overall PPD
                    th Checkout%
            tbody
                    tr
                        td= player.games_played
                        td= player.games_won
                        td= player.games_played == 0 ? 0 : (player.games_won * 100 / player.games_played).toFixed(2)
                        td= statistics.first_nine_ppd.toFixed(2)
                        td= statistics.ppd.toFixed(2)
                        if player.games_won === 0
                            td= '-'
                        else
                            td= statistics.checkout_percentage.toFixed(2) + '%'

        h3 High Scores
        table(id='player-scores-table' class='table table-striped table-bordered')
            thead
                tr
                    th 60+
                    th 100+
                    th 140+
                    th 180s
            tbody
                    tr
                        td= statistics.scores_60s_plus
                        td= statistics.scores_100s_plus
                        td= statistics.scores_140s_plus
                        td= statistics.scores_180s
                    tr
                        th Best PPD / First 9
                        th Best 301
                        th Best 501
                        th Highest Checkout
                    tr
                        td= statistics.best_ppd.toFixed(2) + ' / ' + statistics.best_first_nine_ppd.toFixed(2)
                        td= statistics.best_301
                        td= statistics.best_501
                        td= statistics.highest_checkout

        h3 Accuracy
        table(id='player-accuracy-table' class='table table-striped table-bordered')
            thead
                tr
                    th Overall Accuracy
                    th Accuracy 20s
                    th Accuracy 19s
            tbody
                    tr
                        td= statistics.accuracy_overall === null ? 'Not Available' : statistics.accuracy_overall.toFixed(2)
                        td= statistics.accuracy_20 === null ? 'Not Available' : statistics.accuracy_20.toFixed(2)
                        td= statistics.accuracy_19 === null ? 'Not Available' : statistics.accuracy_19.toFixed(2)

        h3 Hits
        table(id='player-hits-table' class='table table-striped table-bordered')
            thead
                tr
                    th Dart
                    th Count
                    th Hit %
            tbody
                each score, key in statistics.hits
                    each value, multiplier in statistics.hits[key]
                        tr
                            td(class='col-sm-2 dart-score-container' data-order=key + multiplier)
                                if multiplier == 3
                                    label(class='dart-score-triple')= 'T-' + key
                                else if multiplier == 2
                                    if key == 25
                                        label(class='dart-score-double') Bull
                                    else
                                        label(class='dart-score-double')= 'D-' + key
                                else
                                    if key == 0
                                        label(class='dart-score-single') Miss
                                    else if key == 25
                                        label(class='dart-score-single') Bull
                                    else
                                        label(class='dart-score-single')= key
                            td= value
                            td= (value * 100 / statistics.darts_thrown).toFixed(2) + '%'

    h3 Heatmap
    select(id='heatmap-value-selector' name='dart-values')
        option(value=0 default=true) All
        option(value=1) Singles
        option(value=2) Doubles
        option(value=3) Trebles
    div(style='text-align: center;')
        canvas(id='dartboard-heatmap')
